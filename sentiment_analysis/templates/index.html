<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감정 분석 웹 애플리케이션</title>
</head>
<body>
    <h1>텍스트 감정 분석기</h1>
    <textarea id="textInput" rows="5" cols="40" placeholder="분석할 텍스트를 입력하세요"></textarea><br>
    <button onclick="sendAnalyzeRequest()">분석하기</button>

    <div id="result"></div>
    <audio id="audioPlayer" controls style="display: none; margin-top: 20px;"></audio>

    <script>
        function sendAnalyzeRequest() {
            const text = document.getElementById('textInput').value;
            
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('result').innerHTML = `오류: ${data.error}`;
                    document.getElementById('audioPlayer').style.display = 'none'; // 오류가 있을 경우 재생바 숨기기
                } else {
                    document.getElementById('result').innerHTML = `감정: ${data.sentiment} <br> 추천 음악: ${data.music_recommendation.name} by ${data.music_recommendation.artists[0].name}`;

                    // 미리듣기 URL이 있는 경우에만 오디오 재생
                    const previewUrl = data.music_recommendation.preview_url;
                    if (previewUrl) {
                        const audioPlayer = document.getElementById('audioPlayer');
                        audioPlayer.src = previewUrl;
                        audioPlayer.style.display = 'block'; // 오디오 재생바 표시
                        audioPlayer.play(); // 자동으로 음악 재생
                    } else {
                        document.getElementById('audioPlayer').style.display = 'none';
                        document.getElementById('result').innerHTML += `<br>미리듣기를 사용할 수 없습니다.`;
                    }
                }
            })
            .catch(error => {
                document.getElementById('result').innerHTML = `오류 발생: ${error}`;
                document.getElementById('audioPlayer').style.display = 'none'; // 오류가 있을 경우 재생바 숨기기
            });
        }
    </script>
</body>
</html>
